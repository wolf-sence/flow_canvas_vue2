<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div id ="app">
        <canvas width="1200" height="500" id="canvas" class="canvas_wrapper"></canvas>
    </div>
    <!-- <script>
        console.log('enter index')
    </script> -->
    <script async type="module">
        import FlowUnion from '../Union/Union.js';

        let root1 = {
            color: 'black',
            desp: 'test1',
            type: 'step',
            id: '1',
            bounds: {
                width: 160,
                height: 30,
                x: 120,
                y: 120,
            },
            output: [
                {
                    name: "失败",
                    paramName: "failReturn",
                    criteria: "==",
                    value: "0",
                    color: "#f12626",
                    description: "失败锚点"
                },
                // {
                //     name: "成功",
                //     paramName: "sucessReturn",
                //     criteria: "==",
                //     value: "1",
                //     color: "#21c562",
                //     description: "成功出口锚点"
                // },
            ]
        }

        let root2 = {
            color: 'blue',
            type: 'common',
            desp: '测试节点1',
            id: '2',
            bounds: {
                width: 160,
                height: 30,
                x: 400,
                y: 200,
            },
            output: [
                {
                    name: "失败",
                    paramName: "failReturn",
                    criteria: "==",
                    value: "0",
                    color: "#f12626",
                    description: "失败锚点"
                },
                {
                    name: "成功",
                    paramName: "sucessReturn",
                    criteria: "==",
                    value: "1",
                    color: "#21c562",
                    description: "成功出口锚点"
                },
            ]
        }
        let root3 = {
            color: 'gray',
            type: 'multOutput',
            desp: '23452345524526',
            id: '3',
            bounds: {
                width: 160,
                height: 30,
                x: 320,
                y: 360,
            },
            output: [
                {
                    name: "失败",
                    paramName: "failReturn",
                    criteria: "==",
                    value: "0",
                    color: "#f12626",
                    description: "失败锚点"
                },
                {
                    name: "成功",
                    paramName: "sucessReturn",
                    criteria: "==",
                    value: "1",
                    color: "#21c562",
                    description: "成功出口锚点"
                },
            ]
        }
        let root4 = {
            type: 'normalEnd',
            desp: 'asdf',
            id: '14',
            bounds: {
                width: 62,
                height: 62,
                x: 220,
                y: 260,
            },
        }
        let root5 = {
            type: 'start',
            desp: 'asdf',
            id: '15',
            bounds: {
                width: 62,
                height: 62,
                x: 420,
                y: 260,
            },
            output: [
                {
                    name: "成功",
                    value: "0",
                    color: "#21c562",
                },
            ]
        }
        let root6 = {
            type: 'diyEnd',
            desp: 'asdf',
            id: '16',
            bounds: {
                width: 62,
                height: 62,
                x: 420,
                y: 160,
            },
        }
        // root2, root3, root4, 
        let arr = [root1, root2, root3, root4, root5, root6];


        var canvas = document.getElementById('canvas');
        let context = canvas.getContext("2d");
        // canvas.width = document.body.clientWidth;
        // canvas.height = canvas.width;
        
        var devicePixelRatio = window.devicePixelRatio || 1;
        var backingStoreRatio = context.webkitBackingStorePixelRatio ||
            context.mozBackingStorePixelRatio ||
            context.msBackingStorePixelRatio ||
            context.oBackingStorePixelRatio ||
            context.backingStorePixelRatio || 1;
        var ratio = devicePixelRatio / backingStoreRatio;
        console.log('ratio', ratio);

        canvas.style.width = canvas.width+"px";
        canvas.style.height = canvas.height+"px";

        canvas.width = canvas.width * ratio;
        canvas.height = canvas.height * ratio;
        context.scale(ratio, ratio)

        let flow = new FlowUnion(canvas, ratio);
        window.flow = flow.uae;
        flow.loopNodeList(arr);

        flow.uae.$on('contextmenu', e => {
            console.log('-------右键菜单----');
        })

    </script>
</body>
<style>
    .canvas_wrapper{
        border: 1px solid black;
        width: 1200px;
        height: 500px;
    }
</style>
</html>